import {
  useLexicalComposerContext
} from "./chunk-5BMJGEYX.js";
import {
  require_react
} from "./chunk-CANBAPAS.js";
import {
  $toggleLink,
  LinkNode,
  TOGGLE_LINK_COMMAND
} from "./chunk-MSD7RC6N.js";
import {
  mergeRegister,
  objectKlassEquals
} from "./chunk-VPCBVKHR.js";
import "./chunk-VD5PEWHI.js";
import {
  $getSelection,
  $isElementNode,
  $isRangeSelection,
  COMMAND_PRIORITY_LOW,
  PASTE_COMMAND
} from "./chunk-CVCL6TEU.js";
import {
  __toESM
} from "./chunk-5WRI5ZAA.js";

// node_modules/@lexical/react/LexicalLinkPlugin.dev.mjs
var import_react = __toESM(require_react(), 1);
function LinkPlugin({
  validateUrl,
  attributes
}) {
  const [editor] = useLexicalComposerContext();
  (0, import_react.useEffect)(() => {
    if (!editor.hasNodes([LinkNode])) {
      throw new Error("LinkPlugin: LinkNode not registered on editor");
    }
    return mergeRegister(editor.registerCommand(TOGGLE_LINK_COMMAND, (payload) => {
      if (payload === null) {
        $toggleLink(payload);
        return true;
      } else if (typeof payload === "string") {
        if (validateUrl === void 0 || validateUrl(payload)) {
          $toggleLink(payload, attributes);
          return true;
        }
        return false;
      } else {
        const {
          url,
          target,
          rel,
          title
        } = payload;
        $toggleLink(url, {
          ...attributes,
          rel,
          target,
          title
        });
        return true;
      }
    }, COMMAND_PRIORITY_LOW), validateUrl !== void 0 ? editor.registerCommand(PASTE_COMMAND, (event) => {
      const selection = $getSelection();
      if (!$isRangeSelection(selection) || selection.isCollapsed() || !objectKlassEquals(event, ClipboardEvent)) {
        return false;
      }
      const clipboardEvent = event;
      if (clipboardEvent.clipboardData === null) {
        return false;
      }
      const clipboardText = clipboardEvent.clipboardData.getData("text");
      if (!validateUrl(clipboardText)) {
        return false;
      }
      if (!selection.getNodes().some((node) => $isElementNode(node))) {
        editor.dispatchCommand(TOGGLE_LINK_COMMAND, {
          ...attributes,
          url: clipboardText
        });
        event.preventDefault();
        return true;
      }
      return false;
    }, COMMAND_PRIORITY_LOW) : () => {
    });
  }, [editor, validateUrl, attributes]);
  return null;
}
export {
  LinkPlugin
};
//# sourceMappingURL=@lexical_react_LexicalLinkPlugin.js.map
